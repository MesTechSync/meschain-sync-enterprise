{{ header }}{{ column_left }}
<div class="page-header">
	<div class="container-fluid">
		<div class="pull-right">
			<button type="submit" form="form-trendyol" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary">
				<i class="fa fa-save"></i>
			</button>
			<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default">
				<i class="fa fa-reply"></i>
			</a>
		</div>
		<h1>{{ heading_title }}</h1>
		<ul class="breadcrumb">
			{% for breadcrumb in breadcrumbs %}
				<li>
					<a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
				</li>
			{% endfor %}
		</ul>
	</div>
</div>

<div class="container-fluid">
	{% if error_warning %}
		<div class="alert alert-danger alert-dismissible">
			<i class="fa fa-exclamation-circle"></i>
			{{ error_warning }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
	{% endif %}

	{% if success %}
		<div class="alert alert-success alert-dismissible">
			<i class="fa fa-check-circle"></i>
			{{ success }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
	{% endif %}

	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">
				<i class="fa fa-shopping-cart"></i>
				{{ text_trendyol_settings }}</h3>
		</div>
		<div class="panel-body">
			<form
				action="{{ action }}" method="post" enctype="multipart/form-data" id="form-trendyol" class="form-horizontal">

				<!-- Navigation Tabs -->
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active">
						<a href="#tab-general" aria-controls="tab-general" role="tab" data-toggle="tab">
							<i class="fa fa-cog"></i>
							{{ tab_general }}
						</a>
					</li>
					<li role="presentation">
						<a href="#tab-api" aria-controls="tab-api" role="tab" data-toggle="tab">
							<i class="fa fa-key"></i>
							{{ tab_api_settings }}
						</a>
					</li>
					<li role="presentation">
						<a href="#tab-sync" aria-controls="tab-sync" role="tab" data-toggle="tab">
							<i class="fa fa-refresh"></i>
							{{ tab_sync_settings }}
						</a>
					</li>
					<li role="presentation">
						<a href="#tab-webhook" aria-controls="tab-webhook" role="tab" data-toggle="tab">
							<i class="fa fa-bell"></i>
							{{ tab_webhook }}
						</a>
					</li>
					<li role="presentation">
						<a href="#tab-logs" aria-controls="tab-logs" role="tab" data-toggle="tab">
							<i class="fa fa-file-text"></i>
							{{ tab_logs }}
						</a>
					</li>
					<li role="presentation">
						<a href="#tab-help" aria-controls="tab-help" role="tab" data-toggle="tab">
							<i class="fa fa-question-circle"></i>
							{{ tab_help }}
						</a>
					</li>
				</ul>

				<!-- Tab Content -->
				<div
					class="tab-content" style="padding-top: 20px;">

					<!-- General Settings Tab -->
					<div role="tabpanel" class="tab-pane active" id="tab-general">
						<div class="form-group required">
							<label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_status" id="input-status" class="form-control">
									{% if module_trendyol_status %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
									{% else %}
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
									{% endif %}
								</select>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-debug">{{ entry_debug_mode }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_debug" id="input-debug" class="form-control">
									{% if module_trendyol_debug %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
									{% else %}
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
									{% endif %}
								</select>
								<div class="help-block">{{ help_debug_mode }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-test-mode">{{ entry_test_mode }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_test_mode" id="input-test-mode" class="form-control">
									{% if module_trendyol_test_mode %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
									{% else %}
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
									{% endif %}
								</select>
								<div class="help-block">{{ help_test_mode }}</div>
							</div>
						</div>
					</div>

					<!-- API Settings Tab -->
					<div role="tabpanel" class="tab-pane" id="tab-api">
						<div class="form-group required">
							<label class="col-sm-2 control-label" for="input-api-key">{{ entry_api_key }}</label>
							<div class="col-sm-10">
								<input type="text" name="module_trendyol_api_key" value="{{ module_trendyol_api_key }}" placeholder="{{ entry_api_key }}" id="input-api-key" class="form-control"/>
								{% if error_api_key %}
									<div class="text-danger">{{ error_api_key }}</div>
								{% endif %}
								<div class="help-block">{{ help_api_key }}</div>
							</div>
						</div>

						<div class="form-group required">
							<label class="col-sm-2 control-label" for="input-api-secret">{{ entry_api_secret }}</label>
							<div class="col-sm-10">
								<input type="password" name="module_trendyol_api_secret" value="{{ module_trendyol_api_secret }}" placeholder="{{ entry_api_secret }}" id="input-api-secret" class="form-control"/>
								{% if error_api_secret %}
									<div class="text-danger">{{ error_api_secret }}</div>
								{% endif %}
								<div class="help-block">{{ help_api_secret }}</div>
							</div>
						</div>

						<div class="form-group required">
							<label class="col-sm-2 control-label" for="input-supplier-id">{{ entry_supplier_id }}</label>
							<div class="col-sm-10">
								<input type="text" name="module_trendyol_supplier_id" value="{{ module_trendyol_supplier_id }}" placeholder="{{ entry_supplier_id }}" id="input-supplier-id" class="form-control"/>
								{% if error_supplier_id %}
									<div class="text-danger">{{ error_supplier_id }}</div>
								{% endif %}
								<div class="help-block">{{ help_supplier_id }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label">{{ entry_api_test }}</label>
							<div class="col-sm-10">
								<button type="button" id="test-api-connection" class="btn btn-info">
									<i class="fa fa-plug"></i>
									{{ button_test_connection }}
								</button>
								<div id="api-test-result" class="help-block" style="margin-top: 10px;"></div>
							</div>
						</div>
					</div>

					<!-- Sync Settings Tab -->
					<div role="tabpanel" class="tab-pane" id="tab-sync">
						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-auto-sync">{{ entry_auto_sync }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_auto_sync" id="input-auto-sync" class="form-control">
									{% if module_trendyol_auto_sync %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
									{% else %}
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
									{% endif %}
								</select>
								<div class="help-block">{{ help_auto_sync }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-sync-interval">{{ entry_sync_interval }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_sync_interval" id="input-sync-interval" class="form-control">
									{% for interval in sync_intervals %}
										{% if interval.value == module_trendyol_sync_interval %}
											<option value="{{ interval.value }}" selected="selected">{{ interval.text }}</option>
										{% else %}
											<option value="{{ interval.value }}">{{ interval.text }}</option>
										{% endif %}
									{% endfor %}
								</select>
								<div class="help-block">{{ help_sync_interval }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label">{{ entry_manual_sync }}</label>
							<div class="col-sm-10">
								<div class="btn-group" role="group">
									<button type="button" id="sync-products" class="btn btn-success">
										<i class="fa fa-refresh"></i>
										{{ button_sync_products }}
									</button>
									<button type="button" id="sync-orders" class="btn btn-warning">
										<i class="fa fa-shopping-cart"></i>
										{{ button_sync_orders }}
									</button>
									<button type="button" id="sync-categories" class="btn btn-info">
										<i class="fa fa-tags"></i>
										{{ button_sync_categories }}
									</button>
								</div>
								<div id="sync-progress" class="progress" style="margin-top: 10px; display: none;">
									<div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 0%"></div>
								</div>
								<div id="sync-result" class="help-block" style="margin-top: 10px;"></div>
							</div>
						</div>
					</div>

					<!-- Webhook Tab -->
					<div role="tabpanel" class="tab-pane" id="tab-webhook">
						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-webhook-url">{{ entry_webhook_url }}</label>
							<div class="col-sm-10">
								<input type="text" value="{{ webhook_url }}" id="input-webhook-url" class="form-control" readonly/>
								<div class="help-block">{{ help_webhook_url }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label" for="input-webhook-status">{{ entry_webhook_status }}</label>
							<div class="col-sm-10">
								<select name="module_trendyol_webhook_status" id="input-webhook-status" class="form-control">
									{% if module_trendyol_webhook_status %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
									{% else %}
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
									{% endif %}
								</select>
								<div class="help-block">{{ help_webhook_status }}</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label">{{ entry_webhook_test }}</label>
							<div class="col-sm-10">
								<button type="button" id="test-webhook" class="btn btn-info">
									<i class="fa fa-bell"></i>
									{{ button_test_webhook }}
								</button>
								<div id="webhook-test-result" class="help-block" style="margin-top: 10px;"></div>
							</div>
						</div>
					</div>

					<!-- Logs Tab -->
					<div role="tabpanel" class="tab-pane" id="tab-logs">
						<div class="form-group">
							<label class="col-sm-2 control-label">{{ entry_log_management }}</label>
							<div class="col-sm-10">
								<div class="btn-group" role="group">
									<button type="button" id="view-logs" class="btn btn-primary">
										<i class="fa fa-eye"></i>
										{{ button_view_logs }}
									</button>
									<button type="button" id="clear-logs" class="btn btn-danger">
										<i class="fa fa-trash"></i>
										{{ button_clear_logs }}
									</button>
									<button type="button" id="download-logs" class="btn btn-success">
										<i class="fa fa-download"></i>
										{{ button_download_logs }}
									</button>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label class="col-sm-2 control-label">{{ entry_recent_logs }}</label>
							<div class="col-sm-10">
								<div id="log-viewer" class="well" style="height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;">
									{{ recent_logs }}
								</div>
							</div>
						</div>
					</div>

					<!-- Help Tab -->
					<div role="tabpanel" class="tab-pane" id="tab-help">
						<div class="panel panel-info">
							<div class="panel-heading">
								<h4 class="panel-title">{{ text_setup_guide }}</h4>
							</div>
							<div class="panel-body">
								<ol>
									<li>{{ help_step_1 }}</li>
									<li>{{ help_step_2 }}</li>
									<li>{{ help_step_3 }}</li>
									<li>{{ help_step_4 }}</li>
									<li>{{ help_step_5 }}</li>
								</ol>
							</div>
						</div>

						<div class="panel panel-warning">
							<div class="panel-heading">
								<h4 class="panel-title">{{ text_troubleshooting }}</h4>
							</div>
							<div class="panel-body">
								<p>{{ help_troubleshooting }}</p>
								<a href="{{ support_url }}" target="_blank" class="btn btn-primary">
									<i class="fa fa-external-link"></i>
									{{ button_support }}
								</a>
							</div>
						</div>
					</div>

				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function () { // API Connection Test
$('#test-api-connection').on('click', function () {
var btn = $(this);
var result = $('#api-test-result');

btn.prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i>  {{ text_testing }}');
result.html('');

$.ajax({
url: '{{ test_api_url }}',
type: 'POST',
data: {
'api_key': $('#input-api-key').val(),
'api_secret': $('#input-api-secret').val(),
'supplier_id': $('#input-supplier-id').val()
},
dataType: 'json',
success: function (response) {
if (response.success) {
result.html('<div class="alert alert-success"><i class="fa fa-check"></i> ' + response.message + '</div>');
} else {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i> ' + response.error + '</div>');
}
},
error: function (xhr, status, error) {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i>  {{ text_api_error }}: ' + error + '</div>');
},
complete: function () {
btn.prop('disabled', false).html('<i class="fa fa-plug"></i>  {{ button_test_connection }}');
}
});
});

// Sync Functions
$('#sync-products, #sync-orders, #sync-categories').on('click', function () {
var btn = $(this);
var syncType = btn.attr('id').replace('sync-', '');
var progress = $('#sync-progress');
var result = $('#sync-result');

btn.prop('disabled', true);
progress.show();
result.html('');

$.ajax({
url: '{{ sync_url }}',
type: 'POST',
data: {
'type': syncType
},
dataType: 'json',
success: function (response) {
if (response.success) {
result.html('<div class="alert alert-success"><i class="fa fa-check"></i> ' + response.message + '</div>');
} else {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i> ' + response.error + '</div>');
}
},
error: function (xhr, status, error) {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i>  {{ text_sync_error }}: ' + error + '</div>');
},
complete: function () {
btn.prop('disabled', false);
progress.hide();
}
});
});

// Webhook Test
$('#test-webhook').on('click', function () {
var btn = $(this);
var result = $('#webhook-test-result');

btn.prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i>  {{ text_testing }}');
result.html('');

$.ajax({
url: '{{ test_webhook_url }}',
type: 'POST',
dataType: 'json',
success: function (response) {
if (response.success) {
result.html('<div class="alert alert-success"><i class="fa fa-check"></i> ' + response.message + '</div>');
} else {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i> ' + response.error + '</div>');
}
},
error: function (xhr, status, error) {
result.html('<div class="alert alert-danger"><i class="fa fa-times"></i>  {{ text_webhook_error }}: ' + error + '</div>');
},
complete: function () {
btn.prop('disabled', false).html('<i class="fa fa-bell"></i>  {{ button_test_webhook }}');
}
});
});

// Log Management
$('#view-logs').on('click', function () {
$.ajax({
url: '{{ view_logs_url }}',
type: 'GET',
dataType: 'json',
success: function (response) {
if (response.success) {
$('#log-viewer').html(response.logs);
}
}
});
});

$('#clear-logs').on('click', function () {
if (confirm('{{ text_confirm_clear_logs }}')) {
$.ajax({
url: '{{ clear_logs_url }}',
type: 'POST',
dataType: 'json',
success: function (response) {
if (response.success) {
$('#log-viewer').html('{{ text_logs_cleared }}');
}
}
});
}
});

$('#download-logs').on('click', function () {
window.open('{{ download_logs_url }}', '_blank');
});
});
</script>

{{ footer }}
