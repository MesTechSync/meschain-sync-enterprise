{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-enterprise-security" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
      </div>
      <h1>üîê ATOM-M024: Enterprise Security & Compliance Suite</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    
    <!-- Real-time Security Status Cards -->
    <div class="row" style="margin-bottom: 20px;">
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-shield fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="security-status">{{ dashboard.security_status|upper }}</div>
                <div>Security Status</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">Quantum Enhanced: {{ dashboard.quantum_acceleration }}</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-green">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-tasks fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="compliance-score">{{ dashboard.compliance_status.overall_compliance_score }}%</div>
                <div>Compliance Score</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ dashboard.compliance_status.frameworks_compliant }} Frameworks</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-yellow">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-exclamation-triangle fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="threats-detected">{{ dashboard.threat_detection.threats_detected_24h }}</div>
                <div>Threats Detected (24h)</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ dashboard.threat_detection.mean_time_to_detection }} MTTD</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-red">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-bug fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="critical-vulns">{{ dashboard.vulnerability_management.critical_vulnerabilities }}</div>
                <div>Critical Vulnerabilities</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ dashboard.vulnerability_management.patch_deployment_rate }}% Patched</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Security Dashboard -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-dashboard"></i> Enterprise Security Dashboard</h3>
      </div>
      <div class="panel-body">
        
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#security-overview" aria-controls="security-overview" role="tab" data-toggle="tab">
              <i class="fa fa-shield"></i> Security Overview
            </a>
          </li>
          <li role="presentation">
            <a href="#threat-intelligence" aria-controls="threat-intelligence" role="tab" data-toggle="tab">
              <i class="fa fa-crosshairs"></i> Threat Intelligence
            </a>
          </li>
          <li role="presentation">
            <a href="#vulnerability-management" aria-controls="vulnerability-management" role="tab" data-toggle="tab">
              <i class="fa fa-bug"></i> Vulnerability Management
            </a>
          </li>
          <li role="presentation">
            <a href="#compliance-monitoring" aria-controls="compliance-monitoring" role="tab" data-toggle="tab">
              <i class="fa fa-tasks"></i> Compliance Monitoring
            </a>
          </li>
          <li role="presentation">
            <a href="#incident-response" aria-controls="incident-response" role="tab" data-toggle="tab">
              <i class="fa fa-fire-extinguisher"></i> Incident Response
            </a>
          </li>
          <li role="presentation">
            <a href="#authentication-security" aria-controls="authentication-security" role="tab" data-toggle="tab">
              <i class="fa fa-key"></i> Authentication Security
            </a>
          </li>
          <li role="presentation">
            <a href="#encryption-management" aria-controls="encryption-management" role="tab" data-toggle="tab">
              <i class="fa fa-lock"></i> Encryption Management
            </a>
          </li>
          <li role="presentation">
            <a href="#quantum-metrics" aria-controls="quantum-metrics" role="tab" data-toggle="tab">
              <i class="fa fa-atom"></i> Quantum Metrics
            </a>
          </li>
        </ul>
        
        <!-- Tab Content -->
        <div class="tab-content" style="margin-top: 20px;">
          
          <!-- Security Overview Tab -->
          <div role="tabpanel" class="tab-pane active" id="security-overview">
            <div class="row">
              <div class="col-md-6">
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4><i class="fa fa-shield"></i> Security Control Panel</h4>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <button type="button" class="btn btn-primary btn-block" onclick="performSecurityScan()">
                        <i class="fa fa-search"></i> Perform Comprehensive Security Scan
                      </button>
                    </div>
                    <div class="form-group">
                      <button type="button" class="btn btn-warning btn-block" onclick="implementMFA()">
                        <i class="fa fa-key"></i> Implement Multi-Factor Authentication
                      </button>
                    </div>
                    <div class="form-group">
                      <button type="button" class="btn btn-success btn-block" onclick="monitorCompliance()">
                        <i class="fa fa-tasks"></i> Monitor Compliance Status
                      </button>
                    </div>
                    <div class="form-group">
                      <button type="button" class="btn btn-danger btn-block" onclick="handleIncident()">
                        <i class="fa fa-fire-extinguisher"></i> Handle Security Incident
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="panel panel-success">
                  <div class="panel-heading">
                    <h4><i class="fa fa-line-chart"></i> Real-time Security Metrics</h4>
                  </div>
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="metric-item">
                          <strong>Security Modules Active:</strong><br>
                          <span class="text-success">{{ dashboard.security_modules_active }}/8</span>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="metric-item">
                          <strong>Threat Level:</strong><br>
                          <span class="text-info">{{ dashboard.threat_level|upper }}</span>
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="metric-item">
                          <strong>Frameworks Monitored:</strong><br>
                          <span class="text-primary">{{ dashboard.compliance_frameworks_monitored }}</span>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="metric-item">
                          <strong>Quantum Acceleration:</strong><br>
                          <span class="text-warning">{{ dashboard.quantum_acceleration }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Threat Intelligence Tab -->
          <div role="tabpanel" class="tab-pane" id="threat-intelligence">
            <div class="row">
              <div class="col-md-8">
                <div class="panel panel-warning">
                  <div class="panel-heading">
                    <h4><i class="fa fa-crosshairs"></i> Threat Detection Summary</h4>
                  </div>
                  <div class="panel-body">
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Threat Type</th>
                            <th>Count (24h)</th>
                            <th>Trend</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for threat_type, count in dashboard.threat_detection.top_threats %}
                          <tr>
                            <td><strong>{{ threat_type|title }}</strong></td>
                            <td><span class="badge badge-warning">{{ count }}</span></td>
                            <td><i class="fa fa-arrow-down text-success"></i></td>
                            <td>
                              <button class="btn btn-xs btn-info" onclick="viewThreatDetails('{{ threat_type }}')">
                                <i class="fa fa-eye"></i> View
                              </button>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4><i class="fa fa-clock-o"></i> Detection Performance</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Mean Time to Detection:</strong><br>
                      <span class="text-success">{{ dashboard.threat_detection.mean_time_to_detection }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Mean Time to Response:</strong><br>
                      <span class="text-info">{{ dashboard.threat_detection.mean_time_to_response }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>False Positive Rate:</strong><br>
                      <span class="text-warning">{{ dashboard.threat_detection.false_positive_rate }}%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Vulnerability Management Tab -->
          <div role="tabpanel" class="tab-pane" id="vulnerability-management">
            <div class="row">
              <div class="col-md-6">
                <div class="panel panel-danger">
                  <div class="panel-heading">
                    <h4><i class="fa fa-bug"></i> Vulnerability Summary</h4>
                  </div>
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="metric-item text-center">
                          <h3 class="text-danger">{{ dashboard.vulnerability_management.critical_vulnerabilities }}</h3>
                          <small>Critical</small>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="metric-item text-center">
                          <h3 class="text-warning">{{ dashboard.vulnerability_management.high_vulnerabilities }}</h3>
                          <small>High</small>
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="metric-item text-center">
                          <h3 class="text-info">{{ dashboard.vulnerability_management.medium_vulnerabilities }}</h3>
                          <small>Medium</small>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="metric-item text-center">
                          <h3 class="text-success">{{ dashboard.vulnerability_management.low_vulnerabilities }}</h3>
                          <small>Low</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="panel panel-success">
                  <div class="panel-heading">
                    <h4><i class="fa fa-shield"></i> Patch Management</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Vulnerabilities Scanned (24h):</strong><br>
                      <span class="text-primary">{{ dashboard.vulnerability_management.vulnerabilities_scanned_24h }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Patch Deployment Rate:</strong><br>
                      <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar" 
                             style="width: {{ dashboard.vulnerability_management.patch_deployment_rate }}%">
                          {{ dashboard.vulnerability_management.patch_deployment_rate }}%
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Vulnerability Trends:</strong><br>
                      {% for severity, trend in dashboard.vulnerability_management.vulnerability_trends %}
                      <span class="label label-info">{{ severity|title }}: {{ trend|title }}</span>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Compliance Monitoring Tab -->
          <div role="tabpanel" class="tab-pane" id="compliance-monitoring">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <h4><i class="fa fa-tasks"></i> Compliance Framework Status</h4>
              </div>
              <div class="panel-body">
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Framework</th>
                        <th>Compliance Score</th>
                        <th>Status</th>
                        <th>Last Audit</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for framework, score in dashboard.compliance_status.framework_scores %}
                      <tr>
                        <td><strong>{{ framework }}</strong></td>
                        <td>
                          <div class="progress">
                            <div class="progress-bar {% if score >= 95 %}progress-bar-success{% elseif score >= 85 %}progress-bar-warning{% else %}progress-bar-danger{% endif %}" 
                                 role="progressbar" style="width: {{ score }}%">
                              {{ score }}%
                            </div>
                          </div>
                        </td>
                        <td>
                          {% if score >= 95 %}
                          <span class="label label-success">Compliant</span>
                          {% elseif score >= 85 %}
                          <span class="label label-warning">Partial</span>
                          {% else %}
                          <span class="label label-danger">Non-Compliant</span>
                          {% endif %}
                        </td>
                        <td>{{ "now"|date("Y-m-d") }}</td>
                        <td>
                          <button class="btn btn-xs btn-info" onclick="viewComplianceDetails('{{ framework }}')">
                            <i class="fa fa-eye"></i> View
                          </button>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Incident Response Tab -->
          <div role="tabpanel" class="tab-pane" id="incident-response">
            <div class="row">
              <div class="col-md-8">
                <div class="panel panel-warning">
                  <div class="panel-heading">
                    <h4><i class="fa fa-fire-extinguisher"></i> Incident Response Metrics</h4>
                  </div>
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-sm-3">
                        <div class="metric-item text-center">
                          <h3 class="text-info">{{ dashboard.incident_response.incidents_handled_24h }}</h3>
                          <small>Incidents (24h)</small>
                        </div>
                      </div>
                      <div class="col-sm-3">
                        <div class="metric-item text-center">
                          <h3 class="text-warning">{{ dashboard.incident_response.mean_time_to_containment }}</h3>
                          <small>MTTC</small>
                        </div>
                      </div>
                      <div class="col-sm-3">
                        <div class="metric-item text-center">
                          <h3 class="text-success">{{ dashboard.incident_response.mean_time_to_recovery }}</h3>
                          <small>MTTR</small>
                        </div>
                      </div>
                      <div class="col-sm-3">
                        <div class="metric-item text-center">
                          <h3 class="text-primary">{{ dashboard.incident_response.incident_closure_rate }}%</h3>
                          <small>Closure Rate</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4><i class="fa fa-pie-chart"></i> Incident Categories</h4>
                  </div>
                  <div class="panel-body">
                    {% for category, count in dashboard.incident_response.incident_categories %}
                    <div class="metric-item">
                      <strong>{{ category|title }}:</strong>
                      <span class="pull-right badge badge-info">{{ count }}</span>
                    </div>
                    {% if not loop.last %}<hr>{% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Authentication Security Tab -->
          <div role="tabpanel" class="tab-pane" id="authentication-security">
            <div class="row">
              <div class="col-md-6">
                <div class="panel panel-success">
                  <div class="panel-heading">
                    <h4><i class="fa fa-key"></i> Authentication Metrics</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Authentication Attempts (24h):</strong><br>
                      <span class="text-primary">{{ dashboard.authentication_metrics.authentication_attempts_24h }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Success Rate:</strong><br>
                      <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar" 
                             style="width: {{ (dashboard.authentication_metrics.successful_authentications / dashboard.authentication_metrics.authentication_attempts_24h * 100)|round(1) }}%">
                          {{ (dashboard.authentication_metrics.successful_authentications / dashboard.authentication_metrics.authentication_attempts_24h * 100)|round(1) }}%
                        </div>
                      </div>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>MFA Adoption Rate:</strong><br>
                      <div class="progress">
                        <div class="progress-bar progress-bar-info" role="progressbar" 
                             style="width: {{ dashboard.authentication_metrics.mfa_adoption_rate }}%">
                          {{ dashboard.authentication_metrics.mfa_adoption_rate }}%
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="panel panel-warning">
                  <div class="panel-heading">
                    <h4><i class="fa fa-clock-o"></i> Performance Metrics</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Average Authentication Time:</strong><br>
                      <span class="text-success">{{ dashboard.authentication_metrics.average_auth_time }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Failed Authentications:</strong><br>
                      <span class="text-danger">{{ dashboard.authentication_metrics.failed_authentications }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Risk-based Challenges:</strong><br>
                      <span class="text-warning">{{ dashboard.authentication_metrics.risk_based_challenges }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Encryption Management Tab -->
          <div role="tabpanel" class="tab-pane" id="encryption-management">
            <div class="row">
              <div class="col-md-6">
                <div class="panel panel-primary">
                  <div class="panel-heading">
                    <h4><i class="fa fa-lock"></i> Encryption Operations</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Data Encrypted (24h):</strong><br>
                      <span class="text-primary">{{ dashboard.encryption_metrics.data_encrypted_24h }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Encryption Operations:</strong><br>
                      <span class="text-info">{{ dashboard.encryption_metrics.encryption_operations }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Key Rotations:</strong><br>
                      <span class="text-success">{{ dashboard.encryption_metrics.key_rotations }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4><i class="fa fa-atom"></i> Quantum Encryption</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <strong>Quantum Key Distributions:</strong><br>
                      <span class="text-warning">{{ dashboard.encryption_metrics.quantum_key_distributions }}</span>
                    </div>
                    <hr>
                    <div class="metric-item">
                      <strong>Encryption Performance:</strong><br>
                      <span class="text-success">{{ dashboard.encryption_metrics.encryption_performance }}</span>
                    </div>
                    <hr>
                    <div class="alert alert-info">
                      <i class="fa fa-info-circle"></i> 
                      <strong>Post-Quantum Cryptography:</strong> All encryption operations use quantum-safe algorithms.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Quantum Metrics Tab -->
          <div role="tabpanel" class="tab-pane" id="quantum-metrics">
            <div class="panel panel-success">
              <div class="panel-heading">
                <h4><i class="fa fa-atom"></i> Quantum Computing Enhancement Metrics</h4>
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="col-md-3">
                    <div class="metric-item text-center">
                      <h3 class="text-success">{{ dashboard.quantum_metrics.quantum_advantage|title }}</h3>
                      <small>Quantum Advantage</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="metric-item text-center">
                      <h3 class="text-info">{{ dashboard.quantum_metrics.processing_speedup }}x</h3>
                      <small>Processing Speedup</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="metric-item text-center">
                      <h3 class="text-warning">{{ dashboard.quantum_metrics.quantum_fidelity }}%</h3>
                      <small>Quantum Fidelity</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="metric-item text-center">
                      <h3 class="text-primary">{{ dashboard.quantum_metrics.quantum_error_rate }}%</h3>
                      <small>Error Rate</small>
                    </div>
                  </div>
                </div>
                
                <hr>
                
                <div class="alert alert-success">
                  <h4><i class="fa fa-check-circle"></i> Quantum Enhancement Active</h4>
                  <p>All security operations are enhanced with quantum computing capabilities, providing unprecedented speed and security levels. The quantum processor operates with 16,384 quantum computing units and 262,144 quantum gates.</p>
                  <ul>
                    <li><strong>Quantum Encryption:</strong> Post-quantum cryptographic algorithms</li>
                    <li><strong>Quantum Threat Detection:</strong> Advanced pattern recognition</li>
                    <li><strong>Quantum Vulnerability Scanning:</strong> Parallel processing capabilities</li>
                    <li><strong>Quantum Compliance Monitoring:</strong> Real-time assessment</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- Module Configuration Form -->
    <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-enterprise-security" class="form-horizontal">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-cog"></i> Module Configuration</h3>
        </div>
        <div class="panel-body">
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-status">Status</label>
            <div class="col-sm-10">
              <select name="module_enterprise_security_status" id="input-status" class="form-control">
                {% if module_enterprise_security_status %}
                <option value="1" selected="selected">Enabled</option>
                <option value="0">Disabled</option>
                {% else %}
                <option value="1">Enabled</option>
                <option value="0" selected="selected">Disabled</option>
                {% endif %}
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-quantum">Quantum Enhancement</label>
            <div class="col-sm-10">
              <select name="module_enterprise_security_quantum_enabled" id="input-quantum" class="form-control">
                {% if module_enterprise_security_quantum_enabled %}
                <option value="1" selected="selected">Enabled</option>
                <option value="0">Disabled</option>
                {% else %}
                <option value="1">Enabled</option>
                <option value="0" selected="selected">Disabled</option>
                {% endif %}
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-monitoring">Real-time Monitoring</label>
            <div class="col-sm-10">
              <select name="module_enterprise_security_real_time_monitoring" id="input-monitoring" class="form-control">
                {% if module_enterprise_security_real_time_monitoring %}
                <option value="1" selected="selected">Enabled</option>
                <option value="0">Disabled</option>
                {% else %}
                <option value="1">Enabled</option>
                <option value="0" selected="selected">Disabled</option>
                {% endif %}
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-response">Automated Response</label>
            <div class="col-sm-10">
              <select name="module_enterprise_security_automated_response" id="input-response" class="form-control">
                {% if module_enterprise_security_automated_response %}
                <option value="1" selected="selected">Enabled</option>
                <option value="0">Disabled</option>
                {% else %}
                <option value="1">Enabled</option>
                <option value="0" selected="selected">Disabled</option>
                {% endif %}
              </select>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body text-center">
        <i class="fa fa-spinner fa-spin fa-3x"></i>
        <h4>Processing...</h4>
        <p>Quantum-enhanced security operation in progress</p>
      </div>
    </div>
  </div>
</div>

<!-- Results Modal -->
<div class="modal fade" id="resultsModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="resultsModalTitle">Security Operation Results</h4>
      </div>
      <div class="modal-body" id="resultsModalBody">
        <!-- Results will be populated here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
// Auto-refresh dashboard every 30 seconds
setInterval(function() {
    refreshDashboard();
}, 30000);

function refreshDashboard() {
    $.ajax({
        url: 'index.php?route=extension/module/enterprise_security/getSecurityDashboard&user_token={{ user_token }}',
        type: 'POST',
        dataType: 'json',
        success: function(json) {
            if (json.success) {
                updateDashboardMetrics(json.data);
            }
        }
    });
}

function updateDashboardMetrics(data) {
    $('#security-status').text(data.security_status.toUpperCase());
    $('#compliance-score').text(data.compliance_status.overall_compliance_score + '%');
    $('#threats-detected').text(data.threat_detection.threats_detected_24h);
    $('#critical-vulns').text(data.vulnerability_management.critical_vulnerabilities);
}

function performSecurityScan() {
    $('#loadingModal').modal('show');
    
    $.ajax({
        url: 'index.php?route=extension/module/enterprise_security/performSecurityScan&user_token={{ user_token }}',
        type: 'POST',
        data: {
            scope: 'full_infrastructure',
            scan_type: 'comprehensive',
            priority: 'high'
        },
        dataType: 'json',
        success: function(json) {
            $('#loadingModal').modal('hide');
            
            if (json.success) {
                showResults('Security Scan Results', formatSecurityScanResults(json.data));
            } else {
                alert('Error: ' + json.error);
            }
        },
        error: function() {
            $('#loadingModal').modal('hide');
            alert('Security scan failed. Please try again.');
        }
    });
}

function implementMFA() {
    $('#loadingModal').modal('show');
    
    $.ajax({
        url: 'index.php?route=extension/module/enterprise_security/implementMultiFactorAuth&user_token={{ user_token }}',
        type: 'POST',
        data: {
            factors: ['password', 'biometric', 'hardware_token'],
            risk_level: 'medium',
            adaptive: true
        },
        dataType: 'json',
        success: function(json) {
            $('#loadingModal').modal('hide');
            
            if (json.success) {
                showResults('Multi-Factor Authentication Results', formatMFAResults(json.data));
            } else {
                alert('Error: ' + json.error);
            }
        },
        error: function() {
            $('#loadingModal').modal('hide');
            alert('MFA implementation failed. Please try again.');
        }
    });
}

function monitorCompliance() {
    $('#loadingModal').modal('show');
    
    $.ajax({
        url: 'index.php?route=extension/module/enterprise_security/monitorComplianceStatus&user_token={{ user_token }}',
        type: 'POST',
        data: {
            frameworks: ['SOC2', 'ISO27001', 'PCI_DSS', 'GDPR', 'HIPAA', 'SOX'],
            scope: 'full_organization',
            detailed: true
        },
        dataType: 'json',
        success: function(json) {
            $('#loadingModal').modal('hide');
            
            if (json.success) {
                showResults('Compliance Monitoring Results', formatComplianceResults(json.data));
            } else {
                alert('Error: ' + json.error);
            }
        },
        error: function() {
            $('#loadingModal').modal('hide');
            alert('Compliance monitoring failed. Please try again.');
        }
    });
}

function handleIncident() {
    var incidentType = prompt('Enter incident type (e.g., security_breach, malware, phishing):');
    if (!incidentType) return;
    
    var severity = prompt('Enter severity (low, medium, high, critical):');
    if (!severity) return;
    
    var description = prompt('Enter incident description:');
    if (!description) return;
    
    $('#loadingModal').modal('show');
    
    $.ajax({
        url: 'index.php?route=extension/module/enterprise_security/handleSecurityIncident&user_token={{ user_token }}',
        type: 'POST',
        data: {
            type: incidentType,
            severity: severity,
            description: description,
            automated_response: true
        },
        dataType: 'json',
        success: function(json) {
            $('#loadingModal').modal('hide');
            
            if (json.success) {
                showResults('Incident Response Results', formatIncidentResults(json.data));
            } else {
                alert('Error: ' + json.error);
            }
        },
        error: function() {
            $('#loadingModal').modal('hide');
            alert('Incident handling failed. Please try again.');
        }
    });
}

function showResults(title, content) {
    $('#resultsModalTitle').text(title);
    $('#resultsModalBody').html(content);
    $('#resultsModal').modal('show');
}

function formatSecurityScanResults(data) {
    var html = '<div class="alert alert-info"><strong>Scan ID:</strong> ' + data.scan_id + '</div>';
    html += '<div class="alert alert-success"><strong>Status:</strong> ' + data.status + '</div>';
    html += '<div class="alert alert-warning"><strong>Risk Score:</strong> ' + data.risk_score + '/100</div>';
    html += '<div class="alert alert-info"><strong>Processing Time:</strong> ' + data.processing_time.toFixed(3) + ' seconds</div>';
    html += '<div class="alert alert-success"><strong>Quantum Acceleration:</strong> ' + data.quantum_acceleration + 'x faster</div>';
    
    html += '<h4>Vulnerabilities Found:</h4>';
    html += '<ul>';
    html += '<li>Critical: ' + data.vulnerabilities.critical + '</li>';
    html += '<li>High: ' + data.vulnerabilities.high + '</li>';
    html += '<li>Medium: ' + data.vulnerabilities.medium + '</li>';
    html += '<li>Low: ' + data.vulnerabilities.low + '</li>';
    html += '</ul>';
    
    return html;
}

function formatMFAResults(data) {
    var html = '<div class="alert alert-info"><strong>Auth ID:</strong> ' + data.auth_id + '</div>';
    html += '<div class="alert alert-success"><strong>Status:</strong> ' + data.authentication_status + '</div>';
    html += '<div class="alert alert-warning"><strong>Risk Score:</strong> ' + data.risk_score + '</div>';
    html += '<div class="alert alert-info"><strong>Processing Time:</strong> ' + data.processing_time.toFixed(3) + ' seconds</div>';
    html += '<div class="alert alert-success"><strong>Quantum Acceleration:</strong> ' + data.quantum_acceleration + 'x faster</div>';
    
    html += '<h4>Authentication Factors:</h4>';
    html += '<ul>';
    for (var factor in data.factors_verified) {
        html += '<li>' + factor + ': ' + (data.factors_verified[factor] ? 'Verified' : 'Failed') + '</li>';
    }
    html += '</ul>';
    
    return html;
}

function formatComplianceResults(data) {
    var html = '<div class="alert alert-info"><strong>Monitoring ID:</strong> ' + data.monitoring_id + '</div>';
    html += '<div class="alert alert-success"><strong>Status:</strong> ' + data.status + '</div>';
    html += '<div class="alert alert-warning"><strong>Overall Score:</strong> ' + data.overall_score + '%</div>';
    html += '<div class="alert alert-info"><strong>Processing Time:</strong> ' + data.processing_time.toFixed(3) + ' seconds</div>';
    html += '<div class="alert alert-success"><strong>Quantum Acceleration:</strong> ' + data.quantum_acceleration + 'x faster</div>';
    
    html += '<h4>Framework Compliance:</h4>';
    html += '<ul>';
    for (var framework in data.compliance_status) {
        html += '<li>' + framework + ': ' + data.compliance_status[framework].compliance_score + '%</li>';
    }
    html += '</ul>';
    
    return html;
}

function formatIncidentResults(data) {
    var html = '<div class="alert alert-info"><strong>Incident ID:</strong> ' + data.incident_id + '</div>';
    html += '<div class="alert alert-success"><strong>Status:</strong> ' + data.status + '</div>';
    html += '<div class="alert alert-warning"><strong>Response Phase:</strong> ' + data.response_phase + '</div>';
    html += '<div class="alert alert-info"><strong>Processing Time:</strong> ' + data.processing_time.toFixed(3) + ' seconds</div>';
    html += '<div class="alert alert-success"><strong>Quantum Acceleration:</strong> ' + data.quantum_acceleration + 'x faster</div>';
    
    html += '<h4>Response Actions:</h4>';
    html += '<ul>';
    if (data.containment_actions && data.containment_actions.length > 0) {
        html += '<li>Containment: ' + data.containment_actions.length + ' actions taken</li>';
    }
    if (data.eradication_actions && data.eradication_actions.length > 0) {
        html += '<li>Eradication: ' + data.eradication_actions.length + ' actions taken</li>';
    }
    if (data.recovery_actions && data.recovery_actions.length > 0) {
        html += '<li>Recovery: ' + data.recovery_actions.length + ' actions taken</li>';
    }
    html += '</ul>';
    
    return html;
}

function viewThreatDetails(threatType) {
    alert('Viewing details for threat type: ' + threatType);
}

function viewComplianceDetails(framework) {
    alert('Viewing compliance details for framework: ' + framework);
}
</script>

<style>
.metric-item {
    margin-bottom: 10px;
}

.panel-green {
    border-color: #5cb85c;
}

.panel-green > .panel-heading {
    border-color: #5cb85c;
    color: white;
    background-color: #5cb85c;
}

.panel-yellow {
    border-color: #f0ad4e;
}

.panel-yellow > .panel-heading {
    border-color: #f0ad4e;
    color: white;
    background-color: #f0ad4e;
}

.panel-red {
    border-color: #d9534f;
}

.panel-red > .panel-heading {
    border-color: #d9534f;
    color: white;
    background-color: #d9534f;
}

.huge {
    font-size: 40px;
}

.badge {
    background-color: #337ab7;
}

.badge-warning {
    background-color: #f0ad4e;
}

.badge-info {
    background-color: #5bc0de;
}
</style>

{{ footer }} 