{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="button" id="btn-add-app" data-toggle="tooltip" title="{{ button_add_app }}" class="btn btn-primary">
          <i class="fa fa-plus"></i> {{ button_add_app }}
        </button>
        <button type="button" id="btn-send-notification" data-toggle="tooltip" title="{{ button_send_notification }}" class="btn btn-info">
          <i class="fa fa-bell"></i> {{ button_send_notification }}
        </button>
        <button type="button" id="btn-sync-data" data-toggle="tooltip" title="{{ button_sync_data }}" class="btn btn-warning">
          <i class="fa fa-sync"></i> {{ button_sync_data }}
        </button>
        <button type="button" id="btn-refresh" data-toggle="tooltip" title="{{ button_refresh }}" class="btn btn-success">
          <i class="fa fa-refresh"></i>
        </button>
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="container-fluid">
    
    <!-- Alert Messages -->
    <div id="alert-container"></div>

    <!-- Mobile App Statistics Cards -->
    <div class="row">
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-mobile fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="total-apps">{{ mobile_stats.total_apps|default(0) }}</div>
                <div>{{ text_total_apps }}</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ mobile_stats.active_apps|default(0) }} {{ text_active_apps }}</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-green">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-users fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="total-users">{{ mobile_stats.total_users|default(0) }}</div>
                <div>{{ text_total_users }}</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ mobile_stats.monthly_active_users|default(0) }} {{ text_monthly_active_users }}</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-yellow">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-bell fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="monthly-notifications">{{ mobile_stats.monthly_notifications|default(0) }}</div>
                <div>{{ text_monthly_notifications }}</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ (mobile_stats.avg_open_rate|default(0) * 100)|number_format(1) }}% {{ text_avg_open_rate }}</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="panel panel-red">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3">
                <i class="fa fa-line-chart fa-5x"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="huge" id="engagement-rate">95%</div>
                <div>{{ text_engagement_rate }}</div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <span class="pull-left">{{ text_last_24_hours }}</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active">
        <a href="#overview-tab" aria-controls="overview" role="tab" data-toggle="tab">
          <i class="fa fa-dashboard"></i> {{ tab_overview }}
        </a>
      </li>
      <li role="presentation">
        <a href="#apps-tab" aria-controls="apps" role="tab" data-toggle="tab">
          <i class="fa fa-mobile"></i> {{ tab_apps }}
        </a>
      </li>
      <li role="presentation">
        <a href="#users-tab" aria-controls="users" role="tab" data-toggle="tab">
          <i class="fa fa-users"></i> {{ tab_users }}
        </a>
      </li>
      <li role="presentation">
        <a href="#notifications-tab" aria-controls="notifications" role="tab" data-toggle="tab">
          <i class="fa fa-bell"></i> {{ tab_notifications }}
        </a>
      </li>
      <li role="presentation">
        <a href="#analytics-tab" aria-controls="analytics" role="tab" data-toggle="tab">
          <i class="fa fa-line-chart"></i> {{ tab_analytics }}
        </a>
      </li>
      <li role="presentation">
        <a href="#settings-tab" aria-controls="settings" role="tab" data-toggle="tab">
          <i class="fa fa-cog"></i> {{ tab_settings }}
        </a>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      
      <!-- Overview Tab -->
      <div role="tabpanel" class="tab-pane active" id="overview-tab">
        <div class="panel panel-default">
          <div class="panel-body">
            
            <!-- Real-time Metrics -->
            <div class="row">
              <div class="col-lg-8">
                <div class="panel panel-info">
                  <div class="panel-heading">{{ text_real_time_usage }}</div>
                  <div class="panel-body">
                    <canvas id="real-time-chart" width="600" height="300"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-4">
                <div class="panel panel-success">
                  <div class="panel-heading">{{ text_app_distribution }}</div>
                  <div class="panel-body">
                    <canvas id="app-distribution-chart" width="300" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Platform Performance -->
            <div class="row">
              <div class="col-md-4">
                <div class="panel panel-primary">
                  <div class="panel-heading">
                    <h4><i class="fa fa-apple"></i> iOS Apps</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <span class="metric-label">{{ text_active_apps }}:</span>
                      <span class="metric-value" id="ios-active-apps">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ text_total_users }}:</span>
                      <span class="metric-value" id="ios-total-users">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_rating }}:</span>
                      <span class="metric-value" id="ios-rating">0.0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_crashes }}:</span>
                      <span class="metric-value" id="ios-crashes">0</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="panel panel-success">
                  <div class="panel-heading">
                    <h4><i class="fa fa-android"></i> Android Apps</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <span class="metric-label">{{ text_active_apps }}:</span>
                      <span class="metric-value" id="android-active-apps">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ text_total_users }}:</span>
                      <span class="metric-value" id="android-total-users">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_rating }}:</span>
                      <span class="metric-value" id="android-rating">0.0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_crashes }}:</span>
                      <span class="metric-value" id="android-crashes">0</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="panel panel-warning">
                  <div class="panel-heading">
                    <h4><i class="fa fa-globe"></i> PWA Apps</h4>
                  </div>
                  <div class="panel-body">
                    <div class="metric-item">
                      <span class="metric-label">{{ text_active_apps }}:</span>
                      <span class="metric-value" id="pwa-active-apps">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ text_total_users }}:</span>
                      <span class="metric-value" id="pwa-total-users">0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_rating }}:</span>
                      <span class="metric-value" id="pwa-rating">0.0</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">{{ metric_sessions }}:</span>
                      <span class="metric-value" id="pwa-sessions">0</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Activities -->
            <div class="row">
              <div class="col-lg-12">
                <div class="panel panel-default">
                  <div class="panel-heading">{{ text_recent_activities }}</div>
                  <div class="panel-body">
                    <div id="recent-activities-list">
                      <!-- Recent activities will be loaded here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Apps Tab -->
      <div role="tabpanel" class="tab-pane" id="apps-tab">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{ text_mobile_apps_overview }}</h3>
          </div>
          <div class="panel-body">
            
            <!-- App Filters -->
            <div class="row">
              <div class="col-md-3">
                <select class="form-control" id="app-type-filter">
                  <option value="">{{ filter_all_types }}</option>
                  <option value="ios">{{ app_type_ios }}</option>
                  <option value="android">{{ app_type_android }}</option>
                  <option value="react_native">{{ app_type_react_native }}</option>
                  <option value="flutter">{{ app_type_flutter }}</option>
                  <option value="pwa">{{ app_type_pwa }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-control" id="app-status-filter">
                  <option value="">{{ filter_all_statuses }}</option>
                  <option value="active">{{ status_active }}</option>
                  <option value="inactive">{{ status_inactive }}</option>
                  <option value="testing">{{ status_testing }}</option>
                  <option value="maintenance">{{ status_maintenance }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <button class="btn btn-primary" onclick="loadApps()">
                  <i class="fa fa-filter"></i> {{ button_filter }}
                </button>
              </div>
            </div>

            <br>

            <!-- Apps Table -->
            <div class="table-responsive">
              <table class="table table-striped table-hover" id="apps-table">
                <thead>
                  <tr>
                    <th>{{ column_app_name }}</th>
                    <th>{{ column_app_type }}</th>
                    <th>{{ column_version }}</th>
                    <th>{{ column_users }}</th>
                    <th>{{ column_status }}</th>
                    <th>{{ column_last_active }}</th>
                    <th>{{ column_action }}</th>
                  </tr>
                </thead>
                <tbody id="apps-table-body">
                  <!-- Apps will be loaded here -->
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div role="tabpanel" class="tab-pane" id="users-tab">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{ text_app_users }}</h3>
          </div>
          <div class="panel-body">
            
            <!-- User Analytics -->
            <div class="row">
              <div class="col-lg-6">
                <div class="panel panel-info">
                  <div class="panel-heading">{{ chart_user_growth }}</div>
                  <div class="panel-body">
                    <canvas id="user-growth-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-6">
                <div class="panel panel-success">
                  <div class="panel-heading">{{ chart_user_engagement }}</div>
                  <div class="panel-body">
                    <canvas id="user-engagement-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Users Table -->
            <div class="table-responsive">
              <table class="table table-striped table-hover" id="users-table">
                <thead>
                  <tr>
                    <th>{{ column_device_id }}</th>
                    <th>{{ column_device_type }}</th>
                    <th>{{ column_os_version }}</th>
                    <th>{{ column_first_login }}</th>
                    <th>{{ column_last_login }}</th>
                    <th>{{ column_total_orders }}</th>
                    <th>{{ column_total_spent }}</th>
                    <th>{{ column_status }}</th>
                    <th>{{ column_action }}</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                  <!-- Users will be loaded here -->
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

      <!-- Notifications Tab -->
      <div role="tabpanel" class="tab-pane" id="notifications-tab">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{ text_push_notifications }}</h3>
          </div>
          <div class="panel-body">
            
            <!-- Notification Performance -->
            <div class="row">
              <div class="col-lg-12">
                <div class="panel panel-info">
                  <div class="panel-heading">{{ chart_notification_performance }}</div>
                  <div class="panel-body">
                    <canvas id="notification-performance-chart" width="800" height="400"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Notifications Table -->
            <div class="table-responsive">
              <table class="table table-striped table-hover" id="notifications-table">
                <thead>
                  <tr>
                    <th>{{ column_title }}</th>
                    <th>{{ column_message }}</th>
                    <th>{{ column_sent_date }}</th>
                    <th>{{ column_recipients }}</th>
                    <th>{{ column_open_rate }}</th>
                    <th>{{ column_click_rate }}</th>
                    <th>{{ column_status }}</th>
                    <th>{{ column_action }}</th>
                  </tr>
                </thead>
                <tbody id="notifications-table-body">
                  <!-- Notifications will be loaded here -->
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

      <!-- Analytics Tab -->
      <div role="tabpanel" class="tab-pane" id="analytics-tab">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{ analytics_overview }}</h3>
          </div>
          <div class="panel-body">
            
            <!-- Analytics Charts -->
            <div class="row">
              <div class="col-lg-6">
                <div class="panel panel-primary">
                  <div class="panel-heading">{{ chart_daily_active_users }}</div>
                  <div class="panel-body">
                    <canvas id="daily-active-users-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-6">
                <div class="panel panel-warning">
                  <div class="panel-heading">{{ chart_session_duration }}</div>
                  <div class="panel-body">
                    <canvas id="session-duration-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-6">
                <div class="panel panel-success">
                  <div class="panel-heading">{{ chart_device_types }}</div>
                  <div class="panel-body">
                    <canvas id="device-types-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-6">
                <div class="panel panel-info">
                  <div class="panel-heading">{{ chart_geographic_distribution }}</div>
                  <div class="panel-body">
                    <canvas id="geographic-chart" width="400" height="300"></canvas>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div role="tabpanel" class="tab-pane" id="settings-tab">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{ text_configuration }}</h3>
          </div>
          <div class="panel-body">
            
            <form id="mobile-settings-form">
              
              <!-- General Settings -->
              <div class="panel panel-default">
                <div class="panel-heading">{{ config_general_settings }}</div>
                <div class="panel-body">
                  <div class="form-group">
                    <label>{{ config_enable_push }}</label>
                    <select class="form-control" name="enable_push">
                      <option value="1">{{ text_enabled }}</option>
                      <option value="0">{{ text_disabled }}</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>{{ config_enable_analytics }}</label>
                    <select class="form-control" name="enable_analytics">
                      <option value="1">{{ text_enabled }}</option>
                      <option value="0">{{ text_disabled }}</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>{{ config_session_timeout }}</label>
                    <input type="number" class="form-control" name="session_timeout" placeholder="30" />
                    <small class="help-block">Minutes</small>
                  </div>
                </div>
              </div>

              <!-- Push Notification Settings -->
              <div class="panel panel-info">
                <div class="panel-heading">{{ config_push_settings }}</div>
                <div class="panel-body">
                  <div class="form-group">
                    <label>{{ entry_fcm_server_key }}</label>
                    <textarea class="form-control" name="fcm_server_key" rows="3"></textarea>
                    <small class="help-block">{{ help_fcm_server_key }}</small>
                  </div>
                  <div class="form-group">
                    <label>{{ entry_apns_certificate }}</label>
                    <textarea class="form-control" name="apns_certificate" rows="3"></textarea>
                    <small class="help-block">{{ help_apns_certificate }}</small>
                  </div>
                  <div class="form-group">
                    <label>{{ config_max_notification_rate }}</label>
                    <input type="number" class="form-control" name="max_notification_rate" placeholder="100" />
                    <small class="help-block">Per minute</small>
                  </div>
                </div>
              </div>

              <!-- Security Settings -->
              <div class="panel panel-warning">
                <div class="panel-heading">{{ config_security_settings }}</div>
                <div class="panel-body">
                  <div class="form-group">
                    <label>{{ config_enable_location }}</label>
                    <select class="form-control" name="enable_location">
                      <option value="1">{{ text_enabled }}</option>
                      <option value="0">{{ text_disabled }}</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>{{ config_data_retention }}</label>
                    <select class="form-control" name="data_retention">
                      <option value="30">30 Days</option>
                      <option value="90">90 Days</option>
                      <option value="180">180 Days</option>
                      <option value="365">1 Year</option>
                    </select>
                  </div>
                </div>
              </div>

              <button type="button" class="btn btn-primary" onclick="saveMobileSettings()">
                <i class="fa fa-save"></i> {{ button_save }}
              </button>
              
            </form>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Add App Modal -->
<div class="modal fade" id="add-app-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{ button_add_app }}</h4>
      </div>
      <div class="modal-body">
        <form id="add-app-form">
          <div class="form-group">
            <label>{{ entry_app_name }}</label>
            <input type="text" class="form-control" name="app_name" required>
          </div>
          <div class="form-group">
            <label>{{ entry_app_type }}</label>
            <select class="form-control" name="app_type" required>
              <option value="ios">{{ app_type_ios }}</option>
              <option value="android">{{ app_type_android }}</option>
              <option value="react_native">{{ app_type_react_native }}</option>
              <option value="flutter">{{ app_type_flutter }}</option>
              <option value="pwa">{{ app_type_pwa }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>{{ entry_app_version }}</label>
            <input type="text" class="form-control" name="app_version" placeholder="1.0.0">
          </div>
          <div class="form-group" id="bundle-id-group">
            <label>{{ entry_bundle_id }}</label>
            <input type="text" class="form-control" name="bundle_id">
            <small class="help-block">{{ help_bundle_id }}</small>
          </div>
          <div class="form-group" id="package-name-group" style="display: none;">
            <label>{{ entry_package_name }}</label>
            <input type="text" class="form-control" name="package_name">
            <small class="help-block">{{ help_package_name }}</small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ button_cancel }}</button>
        <button type="button" class="btn btn-primary" onclick="saveApp()">{{ button_save }}</button>
      </div>
    </div>
  </div>
</div>

<!-- Send Notification Modal -->
<div class="modal fade" id="send-notification-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{ button_send_notification }}</h4>
      </div>
      <div class="modal-body">
        <form id="send-notification-form">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_notification_title }}</label>
                <input type="text" class="form-control" name="title" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_target_audience }}</label>
                <select class="form-control" name="target_audience">
                  <option value="all">{{ audience_all }}</option>
                  <option value="segment">{{ audience_segment }}</option>
                  <option value="location">{{ audience_location }}</option>
                  <option value="behavior">{{ audience_behavior }}</option>
                </select>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>{{ entry_notification_message }}</label>
            <textarea class="form-control" name="message" rows="3" required></textarea>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_image_url }}</label>
                <input type="url" class="form-control" name="image_url">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_action_url }}</label>
                <input type="url" class="form-control" name="action_url">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_send_date }}</label>
                <input type="datetime-local" class="form-control" name="send_date">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>{{ entry_priority }}</label>
                <select class="form-control" name="priority">
                  <option value="normal">{{ priority_normal }}</option>
                  <option value="high">{{ priority_high }}</option>
                  <option value="urgent">{{ priority_urgent }}</option>
                </select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ button_cancel }}</button>
        <button type="button" class="btn btn-info" onclick="scheduleNotification()">{{ button_schedule }}</button>
        <button type="button" class="btn btn-primary" onclick="sendNotificationNow()">{{ button_send_now }}</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
    // Initialize mobile dashboard
    initializeMobileDashboard();
    
    // Set up event listeners
    setupMobileEventListeners();
    
    // Load initial data
    loadMobileOverview();
    
    // Set up real-time updates
    setupRealTimeUpdates();
});

function initializeMobileDashboard() {
    // Initialize charts
    initializeMobileCharts();
    
    // Load app type specific fields
    $('#add-app-form select[name="app_type"]').change(function() {
        var appType = $(this).val();
        if (appType === 'ios') {
            $('#bundle-id-group').show();
            $('#package-name-group').hide();
        } else if (appType === 'android') {
            $('#bundle-id-group').hide();
            $('#package-name-group').show();
        } else {
            $('#bundle-id-group').hide();
            $('#package-name-group').hide();
        }
    });
}

function setupMobileEventListeners() {
    // Add app button
    $('#btn-add-app').click(function() {
        $('#add-app-modal').modal('show');
    });
    
    // Send notification button
    $('#btn-send-notification').click(function() {
        $('#send-notification-modal').modal('show');
    });
    
    // Sync data button
    $('#btn-sync-data').click(function() {
        syncMobileData();
    });
    
    // Refresh button
    $('#btn-refresh').click(function() {
        refreshMobileDashboard();
    });
    
    // Tab changes
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        var target = $(e.target).attr("href");
        loadMobileTabData(target);
    });
}

function loadMobileOverview() {
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/getOverview&user_token={{ user_token }}',
        type: 'GET',
        dataType: 'json',
        success: function(data) {
            updateMobileOverview(data);
        },
        error: function() {
            showAlert('error', '{{ error_loading_overview }}');
        }
    });
}

function loadApps() {
    var filters = {
        type: $('#app-type-filter').val(),
        status: $('#app-status-filter').val()
    };
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/getApps&user_token={{ user_token }}',
        type: 'POST',
        data: filters,
        dataType: 'json',
        success: function(data) {
            updateAppsTable(data.apps);
        },
        error: function() {
            showAlert('error', '{{ error_loading_apps }}');
        }
    });
}

function saveApp() {
    var formData = $('#add-app-form').serialize();
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/saveApp&user_token={{ user_token }}',
        type: 'POST',
        data: formData,
        dataType: 'json',
        success: function(data) {
            if (data.success) {
                $('#add-app-modal').modal('hide');
                showAlert('success', '{{ success_app_added }}');
                loadApps();
                
                // Show API key if generated
                if (data.api_key) {
                    showApiKeyModal(data.api_key, data.api_secret);
                }
            } else {
                showAlert('error', data.message);
            }
        },
        error: function() {
            showAlert('error', '{{ error_app_save_failed }}');
        }
    });
}

function sendNotificationNow() {
    var formData = $('#send-notification-form').serialize();
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/sendNotification&user_token={{ user_token }}',
        type: 'POST',
        data: formData + '&send_now=1',
        dataType: 'json',
        success: function(data) {
            if (data.success) {
                $('#send-notification-modal').modal('hide');
                showAlert('success', '{{ success_notification_sent }}');
                loadNotifications();
            } else {
                showAlert('error', data.message);
            }
        },
        error: function() {
            showAlert('error', '{{ error_notification_failed }}');
        }
    });
}

function scheduleNotification() {
    var formData = $('#send-notification-form').serialize();
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/scheduleNotification&user_token={{ user_token }}',
        type: 'POST',
        data: formData,
        dataType: 'json',
        success: function(data) {
            if (data.success) {
                $('#send-notification-modal').modal('hide');
                showAlert('success', '{{ success_notification_scheduled }}');
                loadNotifications();
            } else {
                showAlert('error', data.message);
            }
        },
        error: function() {
            showAlert('error', '{{ error_notification_failed }}');
        }
    });
}

function syncMobileData() {
    $('#btn-sync-data').prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> {{ text_syncing }}...');
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/syncData&user_token={{ user_token }}',
        type: 'POST',
        dataType: 'json',
        success: function(data) {
            if (data.success) {
                showAlert('success', '{{ success_data_synced }}');
                refreshMobileDashboard();
            } else {
                showAlert('error', data.message);
            }
        },
        error: function() {
            showAlert('error', '{{ error_sync_failed }}');
        },
        complete: function() {
            $('#btn-sync-data').prop('disabled', false).html('<i class="fa fa-sync"></i> {{ button_sync_data }}');
        }
    });
}

function saveMobileSettings() {
    var formData = $('#mobile-settings-form').serialize();
    
    $.ajax({
        url: 'index.php?route=extension/module/mobile_app_integration/saveSettings&user_token={{ user_token }}',
        type: 'POST',
        data: formData,
        dataType: 'json',
        success: function(data) {
            if (data.success) {
                showAlert('success', '{{ success_settings_saved }}');
            } else {
                showAlert('error', data.message);
            }
        },
        error: function() {
            showAlert('error', '{{ error_settings_save_failed }}');
        }
    });
}

function refreshMobileDashboard() {
    loadMobileOverview();
    loadApps();
    loadUsers();
    loadNotifications();
    showAlert('info', '{{ info_dashboard_refreshed }}');
}

function updateMobileOverview(data) {
    // Update statistics cards
    $('#total-apps').text(data.total_apps);
    $('#total-users').text(data.total_users);
    $('#monthly-notifications').text(data.monthly_notifications);
    
    // Update platform-specific metrics
    $('#ios-active-apps').text(data.ios_apps);
    $('#android-active-apps').text(data.android_apps);
    $('#pwa-active-apps').text(data.pwa_apps);
    
    $('#ios-total-users').text(data.ios_users);
    $('#android-total-users').text(data.android_users);
    $('#pwa-total-users').text(data.pwa_users);
    
    // Update charts
    updateRealTimeChart(data.real_time_data);
    updateAppDistributionChart(data.app_distribution);
}

function loadMobileTabData(tabId) {
    switch(tabId) {
        case '#apps-tab':
            loadApps();
            break;
        case '#users-tab':
            loadUsers();
            break;
        case '#notifications-tab':
            loadNotifications();
            break;
        case '#analytics-tab':
            loadMobileAnalytics();
            break;
    }
}

function setupRealTimeUpdates() {
    // Update real-time metrics every 30 seconds
    setInterval(function() {
        if ($('#overview-tab').hasClass('active')) {
            loadMobileOverview();
        }
    }, 30000);
}

function showAlert(type, message) {
    var alertClass = type === 'success' ? 'alert-success' : type === 'info' ? 'alert-info' : type === 'warning' ? 'alert-warning' : 'alert-danger';
    var alertIcon = type === 'success' ? 'check' : type === 'info' ? 'info-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle';
    
    var html = '<div class="alert ' + alertClass + ' alert-dismissible" role="alert">';
    html += '<button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>';
    html += '<i class="fa fa-' + alertIcon + '"></i> ' + message;
    html += '</div>';
    
    $('#alert-container').html(html);
    
    setTimeout(function() {
        $('#alert-container .alert').fadeOut();
    }, 5000);
}

// Chart initialization functions
function initializeMobileCharts() {
    // Initialize Chart.js charts for mobile analytics
}

function updateRealTimeChart(data) {
    // Update real-time usage chart
}

function updateAppDistributionChart(data) {
    // Update app distribution pie chart
}

function loadUsers() {
    // Load mobile app users
}

function loadNotifications() {
    // Load push notifications
}

function loadMobileAnalytics() {
    // Load mobile analytics data
}

function showApiKeyModal(apiKey, apiSecret) {
    // Show API key modal for new apps
    var html = '<div class="modal fade" id="api-key-modal" tabindex="-1" role="dialog">';
    html += '<div class="modal-dialog" role="document">';
    html += '<div class="modal-content">';
    html += '<div class="modal-header">';
    html += '<h4 class="modal-title">{{ info_api_key_generated }}</h4>';
    html += '</div>';
    html += '<div class="modal-body">';
    html += '<p><strong>API Key:</strong></p>';
    html += '<input type="text" class="form-control" value="' + apiKey + '" readonly onclick="this.select()">';
    html += '<br>';
    html += '<p><strong>API Secret:</strong></p>';
    html += '<input type="text" class="form-control" value="' + apiSecret + '" readonly onclick="this.select()">';
    html += '<br>';
    html += '<div class="alert alert-warning">{{ warning_save_api_keys }}</div>';
    html += '</div>';
    html += '<div class="modal-footer">';
    html += '<button type="button" class="btn btn-default" data-dismiss="modal">{{ button_close }}</button>';
    html += '</div>';
    html += '</div>';
    html += '</div>';
    html += '</div>';
    
    $('body').append(html);
    $('#api-key-modal').modal('show');
    
    $('#api-key-modal').on('hidden.bs.modal', function() {
        $(this).remove();
    });
}
</script>

<style>
.panel-green {
    border-color: #5cb85c;
}
.panel-green > .panel-heading {
    border-color: #5cb85c;
    color: white;
    background-color: #5cb85c;
}

.panel-yellow {
    border-color: #f0ad4e;
}
.panel-yellow > .panel-heading {
    border-color: #f0ad4e;
    color: white;
    background-color: #f0ad4e;
}

.huge {
    font-size: 40px;
}

.metric-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 5px 0;
    border-bottom: 1px solid #eee;
}

.metric-label {
    font-weight: bold;
}

.metric-value {
    color: #337ab7;
    font-weight: bold;
}

#recent-activities-list {
    max-height: 300px;
    overflow-y: auto;
}

.activity-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
}

.activity-item:last-child {
    border-bottom: none;
}

.table-responsive {
    margin-top: 20px;
}

#apps-table-body tr:hover,
#users-table-body tr:hover,
#notifications-table-body tr:hover {
    background-color: #f5f5f5;
}

.form-group label {
    font-weight: bold;
}

.help-block {
    color: #737373;
    font-size: 12px;
}
</style>

{{ footer }} 