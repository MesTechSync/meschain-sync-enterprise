{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="float-end">
                <button type="submit" form="form-settings" data-bs-toggle="tooltip" title="Save" class="btn btn-primary">
                    <i class="fa-solid fa-floppy-disk"></i>
                </button>
                <a href="{{ back }}" data-bs-toggle="tooltip" title="Back" class="btn btn-light">
                    <i class="fa-solid fa-reply"></i>
                </a>
            </div>
            <h1><i class="fa-solid fa-cogs"></i> Extension Settings</h1>
            <ol class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endfor %}
            </ol>
        </div>
    </div>
    <div class="container-fluid">
        <form id="form-settings" action="{{ save_settings }}" method="post" data-oc-toggle="ajax">
            <div class="card">
                <div class="card-header">
                    <i class="fa-solid fa-cogs"></i> General Settings
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <label for="input-sync-interval" class="col-sm-2 col-form-label">Sync Interval (minutes)</label>
                        <div class="col-sm-10">
                            <input type="number" name="sync_interval" value="{{ settings.sync_interval }}" placeholder="60" id="input-sync-interval" class="form-control" min="5" max="1440"/>
                            <div class="form-text">How often to sync data with marketplaces (5-1440 minutes)</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="input-auto-sync" class="col-sm-2 col-form-label">Auto Sync</label>
                        <div class="col-sm-10">
                            <div class="form-check form-switch form-switch-lg">
                                <input type="hidden" name="auto_sync" value="0"/>
                                <input type="checkbox" name="auto_sync" value="1" id="input-auto-sync" class="form-check-input"{% if settings.auto_sync %} checked{% endif %}/>
                            </div>
                            <div class="form-text">Enable automatic synchronization at set intervals</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="input-api-timeout" class="col-sm-2 col-form-label">API Timeout (seconds)</label>
                        <div class="col-sm-10">
                            <input type="number" name="api_timeout" value="{{ settings.api_timeout }}" placeholder="30" id="input-api-timeout" class="form-control" min="10" max="300"/>
                            <div class="form-text">Timeout for API requests to marketplaces (10-300 seconds)</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <i class="fa-solid fa-bug"></i> Debug & Logging
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <label for="input-debug-mode" class="col-sm-2 col-form-label">Debug Mode</label>
                        <div class="col-sm-10">
                            <div class="form-check form-switch form-switch-lg">
                                <input type="hidden" name="debug_mode" value="0"/>
                                <input type="checkbox" name="debug_mode" value="1" id="input-debug-mode" class="form-check-input"{% if settings.debug_mode %} checked{% endif %}/>
                            </div>
                            <div class="form-text">Enable debug mode for detailed logging (use only for troubleshooting)</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="input-log-level" class="col-sm-2 col-form-label">Log Level</label>
                        <div class="col-sm-10">
                            <select name="log_level" id="input-log-level" class="form-control">
                                <option value="debug"{% if settings.log_level == 'debug' %} selected{% endif %}>Debug</option>
                                <option value="info"{% if settings.log_level == 'info' %} selected{% endif %}>Info</option>
                                <option value="warning"{% if settings.log_level == 'warning' %} selected{% endif %}>Warning</option>
                                <option value="error"{% if settings.log_level == 'error' %} selected{% endif %}>Error</option>
                            </select>
                            <div class="form-text">Minimum log level to record</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <i class="fa-solid fa-info-circle"></i> System Information
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Extension Details:</h6>
                            <ul class="list-unstyled">
                                <li><strong>Version:</strong> 3.0.0</li>
                                <li><strong>Author:</strong> MesTech Development Team</li>
                                <li><strong>License:</strong> Commercial</li>
                                <li><strong>Support:</strong> info@mestech.dev</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>System Status:</h6>
                            <ul class="list-unstyled">
                                <li><strong>PHP Version:</strong> {{ php_version|default('Unknown') }}</li>
                                <li><strong>MySQL Version:</strong> {{ mysql_version|default('Unknown') }}</li>
                                <li><strong>OpenCart Version:</strong> {{ oc_version|default('4.0+') }}</li>
                                <li><strong>Extension Status:</strong> <span class="badge bg-success">Active</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#form-settings').on('submit', function(e) {
        e.preventDefault();
        
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            dataType: 'json',
            beforeSend: function() {
                $('#form-settings button[type="submit"]').prop('disabled', true);
            },
            complete: function() {
                $('#form-settings button[type="submit"]').prop('disabled', false);
            },
            success: function(json) {
                $('.alert-dismissible').remove();
                
                if (json.error) {
                    $('#content').prepend('<div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> ' + json.error + ' <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
                }
                
                if (json.success) {
                    $('#content').prepend('<div class="alert alert-success alert-dismissible"><i class="fas fa-check-circle"></i> ' + json.success + ' <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
});
</script>

{{ footer }} 