{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="button" data-toggle="tooltip" title="{{ button_run_all_tests }}" class="btn btn-primary" onclick="runAllTests()">
          <i class="fa fa-play"></i> {{ button_run_all_tests }}
        </button>
        <button type="button" data-toggle="tooltip" title="{{ button_test_history }}" class="btn btn-info" onclick="showTestHistory()">
          <i class="fa fa-history"></i> {{ button_test_history }}
        </button>
        <button type="button" data-toggle="tooltip" title="{{ button_clear_results }}" class="btn btn-warning" onclick="clearResults()">
          <i class="fa fa-eraser"></i> {{ button_clear_results }}
        </button>
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if success %}
    <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}

    <!-- Test Overview -->
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-dashboard"></i> {{ text_test_overview }}</h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number" id="total-marketplaces">6</div>
                  <div class="stat-label">{{ text_total_marketplaces }}</div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number text-success" id="tests-passed">0</div>
                  <div class="stat-label">{{ text_tests_passed }}</div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number text-danger" id="tests-failed">0</div>
                  <div class="stat-label">{{ text_tests_failed }}</div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number text-warning" id="tests-pending">6</div>
                  <div class="stat-label">{{ text_tests_pending }}</div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number" id="avg-response-time">0ms</div>
                  <div class="stat-label">{{ text_avg_response_time }}</div>
                </div>
              </div>
              <div class="col-md-2">
                <div class="stat-box text-center">
                  <div class="stat-number" id="last-test-time">{{ text_never }}</div>
                  <div class="stat-label">{{ text_last_test }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Marketplace Test Cards -->
    <div class="row">
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="trendyol-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/trendyol.png" alt="Trendyol" class="marketplace-logo"> 
              Trendyol
              <span class="pull-right">
                <span class="test-status" id="trendyol-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="trendyol-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="trendyol-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="trendyol-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="trendyol-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="trendyol-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="trendyol-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="trendyol-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('trendyol')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('trendyol')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="n11-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/n11.png" alt="N11" class="marketplace-logo"> 
              N11
              <span class="pull-right">
                <span class="test-status" id="n11-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="n11-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="n11-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="n11-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="n11-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="n11-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="n11-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="n11-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('n11')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('n11')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="amazon-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/amazon.png" alt="Amazon" class="marketplace-logo"> 
              Amazon
              <span class="pull-right">
                <span class="test-status" id="amazon-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="amazon-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="amazon-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="amazon-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="amazon-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="amazon-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="amazon-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="amazon-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('amazon')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('amazon')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="hepsiburada-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/hepsiburada.png" alt="Hepsiburada" class="marketplace-logo"> 
              Hepsiburada
              <span class="pull-right">
                <span class="test-status" id="hepsiburada-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="hepsiburada-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="hepsiburada-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="hepsiburada-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="hepsiburada-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="hepsiburada-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="hepsiburada-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="hepsiburada-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('hepsiburada')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('hepsiburada')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="ebay-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/ebay.png" alt="eBay" class="marketplace-logo"> 
              eBay
              <span class="pull-right">
                <span class="test-status" id="ebay-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="ebay-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="ebay-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="ebay-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="ebay-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="ebay-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="ebay-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="ebay-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('ebay')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('ebay')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4 col-md-6">
        <div class="panel panel-default marketplace-panel" id="ozon-panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              <img src="view/image/marketplaces/ozon.png" alt="Ozon" class="marketplace-logo"> 
              Ozon
              <span class="pull-right">
                <span class="test-status" id="ozon-status">{{ text_not_tested }}</span>
              </span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="test-progress">
              <div class="progress">
                <div class="progress-bar" id="ozon-progress" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            
            <div class="test-details" id="ozon-details">
              <table class="table table-condensed">
                <tr>
                  <td>{{ text_connection_test }}:</td>
                  <td><span class="test-result" id="ozon-connection">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_auth_test }}:</td>
                  <td><span class="test-result" id="ozon-auth">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_categories_test }}:</td>
                  <td><span class="test-result" id="ozon-categories">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_products_test }}:</td>
                  <td><span class="test-result" id="ozon-products">-</span></td>
                </tr>
                <tr>
                  <td>{{ text_orders_test }}:</td>
                  <td><span class="test-result" id="ozon-orders">-</span></td>
                </tr>
              </table>
            </div>
            
            <div class="test-actions">
              <button type="button" class="btn btn-primary btn-sm" onclick="runMarketplaceTest('ozon')">
                <i class="fa fa-play"></i> {{ button_run_test }}
              </button>
              <button type="button" class="btn btn-info btn-sm" onclick="showTestDetails('ozon')">
                <i class="fa fa-info"></i> {{ button_details }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Test Console -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-terminal"></i> {{ text_test_console }}
          <div class="pull-right">
            <button type="button" class="btn btn-xs btn-default" onclick="clearConsole()">
              <i class="fa fa-eraser"></i> {{ button_clear }}
            </button>
          </div>
        </h3>
      </div>
      <div class="panel-body">
        <div id="test-console" class="test-console">
          <div class="console-line">{{ text_console_ready }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Test Details Modal -->
<div class="modal fade" id="testDetailsModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="modalTitle">{{ text_test_details }}</h4>
      </div>
      <div class="modal-body">
        <div id="modalContent">
          <!-- Dynamic content will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ button_close }}</button>
      </div>
    </div>
  </div>
</div>

<!-- Test History Modal -->
<div class="modal fade" id="testHistoryModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{ text_test_history }}</h4>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-striped" id="history-table">
            <thead>
              <tr>
                <th>{{ text_date }}</th>
                <th>{{ text_marketplace }}</th>
                <th>{{ text_test_type }}</th>
                <th>{{ text_result }}</th>
                <th>{{ text_duration }}</th>
                <th>{{ text_details }}</th>
              </tr>
            </thead>
            <tbody id="history-tbody">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ button_close }}</button>
      </div>
    </div>
  </div>
</div>

<style>
.marketplace-panel {
    transition: all 0.3s ease;
}

.marketplace-panel.testing {
    border-color: #337ab7;
    box-shadow: 0 0 10px rgba(51, 122, 183, 0.3);
}

.marketplace-panel.success {
    border-color: #5cb85c;
}

.marketplace-panel.danger {
    border-color: #d9534f;
}

.marketplace-logo {
    width: 20px;
    height: 20px;
    margin-right: 5px;
}

.test-status {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 3px;
    background: #f5f5f5;
}

.test-status.testing {
    background: #337ab7;
    color: white;
}

.test-status.success {
    background: #5cb85c;
    color: white;
}

.test-status.danger {
    background: #d9534f;
    color: white;
}

.test-progress {
    margin-bottom: 15px;
}

.test-result {
    font-weight: bold;
}

.test-result.success {
    color: #5cb85c;
}

.test-result.danger {
    color: #d9534f;
}

.test-result.warning {
    color: #f0ad4e;
}

.test-console {
    background: #2b2b2b;
    color: #ffffff;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    height: 300px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 4px;
}

.console-line {
    margin-bottom: 2px;
    line-height: 1.4;
}

.console-line.success {
    color: #5cb85c;
}

.console-line.error {
    color: #d9534f;
}

.console-line.warning {
    color: #f0ad4e;
}

.console-line.info {
    color: #5bc0de;
}

.stat-box {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: #f9f9f9;
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
}

.test-actions {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.test-details table {
    margin-bottom: 0;
}

.test-details table td {
    border: none;
    padding: 3px 5px;
    font-size: 12px;
}
</style>

<script type="text/javascript">
var marketplaces = ['trendyol', 'n11', 'amazon', 'hepsiburada', 'ebay', 'ozon'];
var testResults = {};
var testStats = {
    passed: 0,
    failed: 0,
    pending: 6
};

function runAllTests() {
    consoleLog('{{ text_starting_all_tests }}', 'info');
    
    var testsRun = 0;
    marketplaces.forEach(function(marketplace, index) {
        setTimeout(function() {
            runMarketplaceTest(marketplace);
        }, index * 2000); // Stagger tests by 2 seconds
    });
}

function runMarketplaceTest(marketplace) {
    consoleLog('{{ text_starting_test }} ' + marketplace.toUpperCase(), 'info');
    
    // Update UI
    $('#' + marketplace + '-panel').addClass('testing');
    $('#' + marketplace + '-status').text('{{ text_testing }}').addClass('testing');
    $('#' + marketplace + '-progress').css('width', '0%');
    
    // Reset test results
    var tests = ['connection', 'auth', 'categories', 'products', 'orders'];
    tests.forEach(function(test) {
        $('#' + marketplace + '-' + test).text('{{ text_pending }}').removeClass('success danger warning');
    });
    
    // Start tests
    runTest(marketplace, 0);
}

function runTest(marketplace, testIndex) {
    var tests = [
        { name: 'connection', label: '{{ text_connection_test }}' },
        { name: 'auth', label: '{{ text_auth_test }}' },
        { name: 'categories', label: '{{ text_categories_test }}' },
        { name: 'products', label: '{{ text_products_test }}' },
        { name: 'orders', label: '{{ text_orders_test }}' }
    ];
    
    if (testIndex >= tests.length) {
        completeMarketplaceTest(marketplace);
        return;
    }
    
    var currentTest = tests[testIndex];
    var progress = ((testIndex + 1) / tests.length) * 100;
    
    $('#' + marketplace + '-progress').css('width', progress + '%');
    $('#' + marketplace + '-' + currentTest.name).text('{{ text_running }}').addClass('warning');
    
    consoleLog('  → {{ text_running_test }} ' + currentTest.label + ' (' + marketplace + ')', 'info');
    
    // Simulate API call
    $.ajax({
        url: '{{ ajax_test_url }}',
        type: 'POST',
        data: {
            marketplace: marketplace,
            test_type: currentTest.name
        },
        dataType: 'json',
        success: function(response) {
            handleTestResult(marketplace, currentTest.name, response);
            setTimeout(function() {
                runTest(marketplace, testIndex + 1);
            }, 1000);
        },
        error: function() {
            handleTestResult(marketplace, currentTest.name, {
                success: false,
                error: '{{ text_ajax_error }}'
            });
            setTimeout(function() {
                runTest(marketplace, testIndex + 1);
            }, 1000);
        }
    });
}

function handleTestResult(marketplace, testName, response) {
    var resultElement = $('#' + marketplace + '-' + testName);
    
    if (response.success) {
        resultElement.text('{{ text_passed }}').removeClass('warning').addClass('success');
        consoleLog('    ✓ ' + testName + ' test passed', 'success');
        
        if (!testResults[marketplace]) testResults[marketplace] = {};
        testResults[marketplace][testName] = {
            status: 'success',
            response_time: response.response_time || 0,
            details: response.details || ''
        };
    } else {
        resultElement.text('{{ text_failed }}').removeClass('warning').addClass('danger');
        consoleLog('    ✗ ' + testName + ' test failed: ' + (response.error || '{{ text_unknown_error }}'), 'error');
        
        if (!testResults[marketplace]) testResults[marketplace] = {};
        testResults[marketplace][testName] = {
            status: 'error',
            error: response.error || '{{ text_unknown_error }}',
            details: response.details || ''
        };
    }
}

function completeMarketplaceTest(marketplace) {
    $('#' + marketplace + '-panel').removeClass('testing');
    $('#' + marketplace + '-progress').css('width', '100%');
    
    // Calculate overall result
    var results = testResults[marketplace] || {};
    var passed = 0;
    var total = 0;
    
    Object.keys(results).forEach(function(test) {
        total++;
        if (results[test].status === 'success') {
            passed++;
        }
    });
    
    if (passed === total && total > 0) {
        $('#' + marketplace + '-panel').addClass('success');
        $('#' + marketplace + '-status').text('{{ text_all_passed }}').removeClass('testing').addClass('success');
        consoleLog('✓ ' + marketplace.toUpperCase() + ' {{ text_all_tests_passed }}', 'success');
        testStats.passed++;
    } else {
        $('#' + marketplace + '-panel').addClass('danger');
        $('#' + marketplace + '-status').text('{{ text_some_failed }}').removeClass('testing').addClass('danger');
        consoleLog('✗ ' + marketplace.toUpperCase() + ' {{ text_some_tests_failed }}', 'error');
        testStats.failed++;
    }
    
    testStats.pending--;
    updateStats();
}

function updateStats() {
    $('#tests-passed').text(testStats.passed);
    $('#tests-failed').text(testStats.failed);
    $('#tests-pending').text(testStats.pending);
    
    // Calculate average response time
    var totalTime = 0;
    var totalTests = 0;
    
    Object.keys(testResults).forEach(function(marketplace) {
        Object.keys(testResults[marketplace]).forEach(function(test) {
            if (testResults[marketplace][test].response_time) {
                totalTime += testResults[marketplace][test].response_time;
                totalTests++;
            }
        });
    });
    
    if (totalTests > 0) {
        $('#avg-response-time').text(Math.round(totalTime / totalTests) + 'ms');
    }
    
    $('#last-test-time').text(new Date().toLocaleTimeString());
}

function showTestDetails(marketplace) {
    $('#modalTitle').text(marketplace.toUpperCase() + ' {{ text_test_details }}');
    
    var content = '<h4>{{ text_test_results }}</h4>';
    
    if (testResults[marketplace]) {
        content += '<table class="table table-bordered">';
        content += '<thead><tr><th>{{ text_test }}</th><th>{{ text_status }}</th><th>{{ text_response_time }}</th><th>{{ text_details }}</th></tr></thead>';
        content += '<tbody>';
        
        Object.keys(testResults[marketplace]).forEach(function(test) {
            var result = testResults[marketplace][test];
            var statusClass = result.status === 'success' ? 'success' : 'danger';
            var statusText = result.status === 'success' ? '{{ text_passed }}' : '{{ text_failed }}';
            
            content += '<tr>';
            content += '<td>' + test + '</td>';
            content += '<td><span class="label label-' + statusClass + '">' + statusText + '</span></td>';
            content += '<td>' + (result.response_time || '-') + 'ms</td>';
            content += '<td>' + (result.details || result.error || '-') + '</td>';
            content += '</tr>';
        });
        
        content += '</tbody></table>';
    } else {
        content += '<p>{{ text_no_test_results }}</p>';
    }
    
    $('#modalContent').html(content);
    $('#testDetailsModal').modal('show');
}

function showTestHistory() {
    $.ajax({
        url: '{{ ajax_history_url }}',
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            if (response.success) {
                displayTestHistory(response.data);
            } else {
                alert('{{ text_history_error }}: ' + response.error);
            }
        },
        error: function() {
            alert('{{ text_ajax_error }}');
        }
    });
}

function displayTestHistory(history) {
    var tbody = $('#history-tbody');
    tbody.empty();
    
    if (history.length > 0) {
        history.forEach(function(record) {
            var statusClass = record.overall_result === 'success' ? 'success' : 'danger';
            var statusText = record.overall_result === 'success' ? '{{ text_passed }}' : '{{ text_failed }}';
            
            var row = '<tr>';
            row += '<td>' + record.test_date + '</td>';
            row += '<td>' + record.marketplace + '</td>';
            row += '<td>' + record.test_type + '</td>';
            row += '<td><span class="label label-' + statusClass + '">' + statusText + '</span></td>';
            row += '<td>' + record.total_duration + 'ms</td>';
            row += '<td><button class="btn btn-xs btn-info" onclick="showHistoryDetails(' + record.id + ')">{{ button_view }}</button></td>';
            row += '</tr>';
            
            tbody.append(row);
        });
    } else {
        tbody.html('<tr><td colspan="6" class="text-center">{{ text_no_history_data }}</td></tr>');
    }
    
    $('#testHistoryModal').modal('show');
}

function clearResults() {
    if (confirm('{{ text_confirm_clear_results }}')) {
        testResults = {};
        testStats = { passed: 0, failed: 0, pending: 6 };
        
        marketplaces.forEach(function(marketplace) {
            $('#' + marketplace + '-panel').removeClass('testing success danger');
            $('#' + marketplace + '-status').text('{{ text_not_tested }}').removeClass('testing success danger');
            $('#' + marketplace + '-progress').css('width', '0%');
            
            var tests = ['connection', 'auth', 'categories', 'products', 'orders'];
            tests.forEach(function(test) {
                $('#' + marketplace + '-' + test).text('-').removeClass('success danger warning');
            });
        });
        
        updateStats();
        clearConsole();
        consoleLog('{{ text_results_cleared }}', 'info');
    }
}

function clearConsole() {
    $('#test-console').html('<div class="console-line">{{ text_console_ready }}</div>');
}

function consoleLog(message, type) {
    var timestamp = new Date().toLocaleTimeString();
    var logClass = type ? 'console-line ' + type : 'console-line';
    var logLine = '<div class="' + logClass + '">[' + timestamp + '] ' + message + '</div>';
    
    $('#test-console').append(logLine);
    $('#test-console').scrollTop($('#test-console')[0].scrollHeight);
}

// Initialize on page load
$(document).ready(function() {
    consoleLog('{{ text_test_system_ready }}', 'info');
    updateStats();
});
</script>

{{ footer }} 